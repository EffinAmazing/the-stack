<div class="main">
    <app-header *ngIf="authUser" [user]="authUser"></app-header>
    <div class="mt-container"> 
      <h2> Build Your Stack </h2>  
      
      
      <div class="stackContainer">
        
        <div class="stackActions" *ngIf="loaded" >
          <div>
              <button mat-raised-button (click)="handleHideList()"> <mat-icon>list</mat-icon> Show or Hide Tools </button>
              
              <button mat-raised-button (click)="handleAddNewTool()"> <mat-icon>add</mat-icon> Add Tool </button>
          </div>
          <div>
            <div class="share-block" *ngIf="loaded">
              <span class="title"> Share </span>
              <div class="waiting-process" *ngIf="isWaiting"> <mat-spinner [diameter]="25"></mat-spinner> </div>
              <button mat-icon-button class="share-image-button" (click)="handleShare('facebook')"> <img class="social-icon" [src]="getAssetsFolder() + 'assets/images/facebook.svg'" /> </button>
              <button mat-icon-button class="share-image-button" (click)="handleShare('linkedin')"> <img class="social-icon" [src]="getAssetsFolder() + 'assets/images/linkedin.svg'" /> </button>
              <button mat-icon-button class="share-image-button" (click)="handleShare('twitter')"> <img class="social-icon" [src]="getAssetsFolder() + 'assets/images/twitter.svg'" /> </button>
              <!-- <button mat-icon-button class="share-image-button" (click)="handleShare('email')"> <img class="social-icon" [src]="getAssetsFolder() + 'assets/images/email.svg'" /> </button> -->
            </div> 
          </div>
          <div>
            
            <button mat-raised-button *ngIf="selectedArrow" (click)="handleDeselectArrow()"> Cancel </button>
            <button mat-raised-button *ngIf="selectedArrow" class="delete-arrow-action" (click)="handleRemoveArrow()"> <mat-icon>clear</mat-icon>  Delete Arrow </button>
            <button mat-stroked-button 
                [disabled]="history.isActivePrev(blueprint.id)"
                (click)="handlePrevAction()"> <mat-icon>undo</mat-icon> </button>
            <button mat-stroked-button 
                [disabled]="history.isActiveNext(blueprint.id)"
                (click)="handleNextAction()"> <mat-icon>redo</mat-icon> </button>
            
          </div>
        </div>
        <div class="loading-data-section" *ngIf="!loaded && !isError">
          <mat-spinner></mat-spinner>
          <p class="loading-message"> Data being processed please wait... </p>
        </div>
        <div *ngIf="isError" class="error-loading-alert">
          <mat-icon color="accent">warning</mat-icon>
          <p class="error-message"> {{errMessage}} </p>
          <div class="error-message"><app-subdomain-detect [domain]="domain"></app-subdomain-detect></div>
          <p class="error-message">
            <button mat-raised-button color="primary" (click)="moveToHome()"> Try Again </button>
          </p>
        </div>
        <app-builder *ngIf="loaded" 
          [loadedNodes]="changedNodes$" 
          [loadedArrows]="changedArrows$"
          [historyEmit]="history.getEmmiter(blueprint.id)"
          [addedNewNode]="addedNewNode$"
          [updatedOutNodeData]="changeNodeData$"
          (positionNodeChanged)="updatedNodePosiotion($event)"
          (arrowAdded)="handleAddArrow($event)"
          (arrowUpdated)="handleUpdateArrow($event)"
          (hideNode)="handleHideNode($event)"
          (removeArrows)="handleRemoveArrows($event)"
          (selectArrow)="handleSlectArrow($event)"
          (updatedNodeData)="handleUpdatedNodeData($event)"
          ></app-builder>


        <div class="bottom-actions" *ngIf="loaded" > 
          <div>
            <button *ngIf="!id" mat-raised-button color="primary" (click)="createNewStack()"> Create new stack </button>
            <button mat-raised-button color="primary" (click)="handleClickInviteUser()"> Invite users </button>
          </div>
          <div>
            <span class="total-spand-tools" *ngIf="blueprint.spend"> 
              Estimated Monthly Tool Spend: <span class="price-amount"> ${{ parsePrice(blueprint.spend) }} </span> 
              <button mat-icon-button (click)="handleClickInfo()"> <img class="mat-button-icon-info" [src]="getAssetsFolder() + 'assets/images/info.png'" /> </button> &nbsp; 
            </span> 
          </div>
          <div>
            <button mat-raised-button class="delete-arrow-action" (click)="removeStack()"> Delete stack </button>
          </div>
        </div>
        <mat-divider></mat-divider>
        <div #categoriesList>
          <app-tools-list  [ngClass]="{'hideTools': false}" *ngIf="loaded" 
            [loadedNodes]="changedNodes$" 
            [loadedCategories]="changedCategories$"
            [updatedOutNodeData]="changeNodeData$"
            [addedNewNode]="addedNewNode$"
            (toogleVisibilityNode)="handleHideNodeItem($event)"
            (closeTools)="handleCloseTools()"
            (updatedNodeData)="handleUpdatedNodeData($event)"
            ></app-tools-list>
        </div>
      </div>
      <canvas id="share-image-canvas"></canvas>
    </div>
</div>
